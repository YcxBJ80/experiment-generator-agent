# 实验可视化管理后台

这是一个独立的管理后台应用，用于管理和可视化实验生成器系统的用户数据。

## 功能特性

### 📊 数据仪表板
- **用户统计**: 显示总用户数、总消息数和平均消息数
- **消息数统计图表**: 柱状图展示每个用户的消息数量（前10名）
- **访问类型分布**: 饼图展示软件访问、API访问和未分配用户的分布
- **用户详情表格**: 完整展示所有用户的信息，包括用户名、邮箱、消息数、最后活跃时间、注册时间和访问类型

### 👥 用户管理
- **用户列表**: 展示所有注册用户的详细信息
- **访问类型分配**: 为每个用户分配访问类型（软件/API）
- **搜索功能**: 按用户名或邮箱搜索用户
- **过滤功能**: 按访问类型筛选用户（全部/软件/API/未分配）
- **实时更新**: 修改用户访问类型后立即生效

## 技术栈

- **前端框架**: React 18 + TypeScript
- **构建工具**: Vite 5
- **样式**: Tailwind CSS
- **图表库**: Recharts
- **数据库**: Supabase (PostgreSQL)
- **UI组件**: 自定义组件

## 快速开始

### 1. 安装依赖

```bash
cd Admin
npm install
```

### 2. 配置环境变量

复制 `.env.example` 文件为 `.env.local`，并填写 Supabase 配置：

```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
VITE_SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key
```

> **注意**: 建议使用 `VITE_SUPABASE_SERVICE_ROLE_KEY` 以获得完整的数据库访问权限。

### 3. 运行数据库迁移

确保已经运行了最新的数据库迁移，特别是添加 `access_type` 字段的迁移：

```bash
# 在项目根目录运行
cd ..
# 如果使用 Supabase CLI
supabase db push
```

或者手动在 Supabase 控制台执行 `supabase/migrations/20251029000000_add_access_type_to_user_profiles.sql`。

### 4. 启动开发服务器

```bash
npm run dev
```

应用将在 http://localhost:5174 上运行。

### 5. 构建生产版本

```bash
npm run build
```

构建产物将输出到 `dist/` 目录。

### 6. 预览生产版本

```bash
npm run preview
```

## 使用说明

### 数据仪表板

1. 点击顶部导航栏的"数据仪表板"进入
2. 查看顶部的统计卡片，了解总体数据
3. 查看柱状图，了解用户消息数排名
4. 查看饼图，了解用户访问类型分布
5. 滚动到底部查看完整的用户详情表格

### 用户管理

1. 点击顶部导航栏的"用户管理"进入
2. 使用搜索框按用户名或邮箱搜索用户
3. 使用过滤按钮按访问类型筛选用户
4. 点击操作列中的按钮为用户分配访问类型：
   - **软件**: 用户通过软件客户端访问
   - **API**: 用户直接使用API访问
   - **清除**: 移除用户的访问类型分配
5. 查看底部的统计卡片了解分配情况

## 数据库结构

管理后台依赖以下数据库表：

- `user_profiles`: 用户信息表，包含 `access_type` 字段
- `messages`: 消息表，通过 `user_id` 关联用户

## 开发注意事项

1. **端口配置**: 默认端口为 5174，避免与主应用（5173）冲突
2. **环境变量**: 所有环境变量必须以 `VITE_` 开头才能在前端访问
3. **数据权限**: 使用 Service Role Key 可以绕过 RLS 策略，请妥善保管
4. **实时更新**: 目前不支持实时数据推送，需要手动刷新

## 未来改进

- [ ] 添加用户活动日志
- [ ] 实现数据导出功能
- [ ] 添加更多图表类型
- [ ] 支持批量操作用户
- [ ] 实现实时数据更新（WebSocket）
- [ ] 添加用户详情页面
- [ ] 支持用户删除和禁用功能

## 许可证

与主项目保持一致

