# 管理后台使用指南

## 📌 概述

这是一个独立的管理后台应用，用于管理实验生成器系统的用户数据。它与主应用完全分离，不会影响现有系统。

## 🎯 主要功能

### 1. 数据可视化
- 用户总数、消息总数、平均消息数统计
- 用户消息数量排行榜（柱状图）
- 用户访问类型分布（饼图）
- 用户详细信息表格

### 2. 用户管理
- 为用户分配访问类型（软件/API）
- 按用户名或邮箱搜索
- 按访问类型筛选
- 实时更新和保存

## 🚀 快速启动

```bash
# 1. 进入 Admin 目录
cd Admin

# 2. 安装依赖
npm install

# 3. 配置环境变量（复制 .env.example 为 .env.local 并填入配置）
cp .env.example .env.local

# 4. 启动开发服务器
npm run dev
```

访问: http://localhost:5174

## 📸 界面预览

### 数据仪表板
```
┌─────────────────────────────────────────────────────────┐
│  统计卡片                                                │
│  [总用户数]  [总消息数]  [平均消息数]                    │
├─────────────────────────────────────────────────────────┤
│  图表区域                                                │
│  [用户消息数柱状图]    [访问类型饼图]                    │
├─────────────────────────────────────────────────────────┤
│  用户详情表格                                            │
│  用户名 | 邮箱 | 消息数 | 最后活跃 | 注册时间 | 访问类型 │
└─────────────────────────────────────────────────────────┘
```

### 用户管理
```
┌─────────────────────────────────────────────────────────┐
│  [搜索框]  [全部] [软件] [API] [未分配]  [刷新]         │
├─────────────────────────────────────────────────────────┤
│  用户列表                                                │
│  [用户信息] [邮箱] [注册时间] [访问类型] [操作按钮]      │
├─────────────────────────────────────────────────────────┤
│  统计卡片                                                │
│  [总数] [软件] [API] [未分配]                            │
└─────────────────────────────────────────────────────────┘
```

## 🔑 访问类型说明

### 软件访问 (Software)
- 用户通过你的软件客户端访问系统
- 适合需要图形界面的普通用户
- 可能包含额外的客户端功能

### API访问 (API)
- 用户直接调用API接口
- 适合开发者或需要集成的用户
- 更灵活的使用方式

### 未分配
- 新注册用户的默认状态
- 需要管理员手动分配访问类型

## 💾 数据库变更

管理后台需要在 `user_profiles` 表中添加 `access_type` 字段：

```sql
ALTER TABLE user_profiles
  ADD COLUMN IF NOT EXISTS access_type VARCHAR(20) 
  CHECK (access_type IN ('software', 'api'));

CREATE INDEX IF NOT EXISTS idx_user_profiles_access_type 
  ON user_profiles(access_type);
```

迁移文件已创建在: `supabase/migrations/20251029000000_add_access_type_to_user_profiles.sql`

## 📂 目录结构

```
Admin/
├── public/              # 静态资源
│   └── favicon.svg
├── src/
│   ├── lib/            # 工具库
│   │   └── supabase.ts # Supabase 客户端
│   ├── pages/          # 页面组件
│   │   ├── Dashboard.tsx      # 数据仪表板
│   │   └── UserManagement.tsx # 用户管理
│   ├── types/          # 类型定义
│   │   └── database.ts
│   ├── App.tsx         # 主应用组件
│   ├── main.tsx        # 应用入口
│   └── index.css       # 全局样式
├── .env.example        # 环境变量示例
├── package.json        # 依赖配置
├── vite.config.ts      # Vite 配置
├── tailwind.config.js  # Tailwind 配置
├── README.md           # 详细说明
├── QUICKSTART.md       # 快速启动指南
└── ADMIN_GUIDE.md      # 本文件
```

## 🔒 安全注意事项

1. **环境变量保护**
   - 不要提交 `.env.local` 到版本控制
   - `.env.local` 已添加到 `.gitignore`

2. **Service Role Key**
   - 具有完全数据库访问权限
   - 仅在管理后台使用
   - 妥善保管，不要泄露

3. **访问控制**
   - 管理后台应该部署在受保护的环境
   - 建议添加身份验证层
   - 限制访问IP地址（如果可能）

## 🛠️ 开发提示

### 修改端口
编辑 `vite.config.ts`:
```typescript
server: {
  port: 5174, // 改为其他端口
}
```

### 添加新功能
1. 在 `src/pages/` 添加新页面组件
2. 在 `App.tsx` 中添加路由
3. 在 `src/types/` 添加必要的类型定义

### 调试
```bash
# 查看控制台日志
npm run dev

# TypeScript 类型检查
npx tsc --noEmit

# ESLint 检查
npm run lint
```

## 📊 性能优化建议

1. **数据分页**: 当用户数量很大时，考虑添加分页
2. **缓存**: 使用 React Query 或 SWR 缓存数据
3. **实时更新**: 使用 Supabase Realtime 订阅数据变化
4. **懒加载**: 按需加载图表组件

## 🐛 故障排除

### 问题: 无法连接到数据库
- 检查 `.env.local` 配置是否正确
- 确认 Supabase 项目状态正常
- 检查网络连接

### 问题: 数据不显示
- 确认数据库中有数据
- 检查浏览器控制台错误
- 验证 RLS 策略配置

### 问题: 构建失败
- 删除 `node_modules` 和 `package-lock.json`
- 重新运行 `npm install`
- 确保 Node.js 版本 >= 16

## 📝 更新日志

### v1.0.0 (2025-10-29)
- ✨ 初始版本发布
- 📊 数据仪表板功能
- 👥 用户管理功能
- 🎨 深色主题UI
- 📈 Recharts 图表集成

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

与主项目保持一致

