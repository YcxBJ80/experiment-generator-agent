# AIå®éªŒå¯è§†åŒ–å¹³å° - æŠ€æœ¯æ¶æ„æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºAIçš„å®éªŒå¯è§†åŒ–å¹³å°ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€æè¿°å®éªŒéœ€æ±‚ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆäº¤äº’å¼çš„HTMLå®éªŒæ¼”ç¤ºã€‚å¹³å°é›†æˆäº†Perplexity AIè¿›è¡ŒçŸ¥è¯†æ£€ç´¢ï¼Œä½¿ç”¨OpenAI/OpenRouterè¿›è¡Œå®éªŒä»£ç ç”Ÿæˆï¼Œå¹¶æä¾›å®Œæ•´çš„å¯¹è¯ç®¡ç†å’Œç”¨æˆ·åé¦ˆç³»ç»Ÿã€‚

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ¤– AIé©±åŠ¨çš„å®éªŒç”Ÿæˆï¼šé€šè¿‡è‡ªç„¶è¯­è¨€æè¿°ç”Ÿæˆäº¤äº’å¼å®éªŒæ¼”ç¤º
- ğŸ” æ™ºèƒ½çŸ¥è¯†æ£€ç´¢ï¼šé›†æˆPerplexity MCPè·å–å‡†ç¡®çš„ç§‘å­¦çŸ¥è¯†
- ğŸ’¬ å¯¹è¯å¼äº¤äº’ï¼šæ”¯æŒå¤šè½®å¯¹è¯å’Œå†å²è®°å½•ç®¡ç†
- ğŸ“Š å®æ—¶æµå¼å“åº”ï¼šæ”¯æŒSSEæµå¼ç”Ÿæˆï¼Œæä¾›å®æ—¶åé¦ˆ
- ğŸ“ ç”¨æˆ·åé¦ˆç³»ç»Ÿï¼šæ”¶é›†å®éªŒè´¨é‡è¯„ä»·å’Œæ”¹è¿›å»ºè®®
- ğŸ¨ ç°ä»£åŒ–UIï¼šåŸºäºReactå’ŒTailwind CSSçš„å“åº”å¼ç•Œé¢

## æŠ€æœ¯æ ˆ

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: React 18.3.1 + TypeScript
- **æ„å»ºå·¥å…·**: Vite 4.4.1
- **è·¯ç”±**: React Router DOM 7.3.0
- **çŠ¶æ€ç®¡ç†**: Zustand 5.0.3
- **UIæ¡†æ¶**: Tailwind CSS 3.0
- **å›¾æ ‡åº“**: Lucide React 0.511.0
- **HTTPå®¢æˆ·ç«¯**: Axios 1.11.0
- **å·¥å…·åº“**: 
  - clsx 2.1.1 (æ¡ä»¶ç±»å)
  - tailwind-merge 3.0.2 (ç±»ååˆå¹¶)
  - react-bits 1.0.5 (UIç»„ä»¶)

### åç«¯æŠ€æœ¯æ ˆ
- **è¿è¡Œæ—¶**: Node.js + TypeScript
- **æ¡†æ¶**: Express.js 4.21.2
- **å¼€å‘å·¥å…·**: 
  - tsx (TypeScriptæ‰§è¡Œå™¨)
  - nodemon 3.1.10 (çƒ­é‡è½½)
  - concurrently 9.2.0 (å¹¶å‘è¿è¡Œ)
- **AIé›†æˆ**:
  - OpenAI SDK 5.12.1
  - Model Context Protocol (MCP) SDK 1.17.2
- **æ•°æ®åº“**: Supabase (PostgreSQL)
- **éªŒè¯**: Zod 4.0.15
- **ç¯å¢ƒé…ç½®**: dotenv 17.2.1
- **è·¨åŸŸ**: CORS 2.8.5

### éƒ¨ç½²å’ŒåŸºç¡€è®¾æ–½
- **éƒ¨ç½²å¹³å°**: Vercel
- **æ•°æ®åº“**: Supabase (æ‰˜ç®¡PostgreSQL)
- **AIæœåŠ¡**: OpenRouter (å¤šæ¨¡å‹APIç½‘å…³)
- **çŸ¥è¯†æ£€ç´¢**: Perplexity AI (é€šè¿‡MCPåè®®)

## é¡¹ç›®æ¶æ„

### æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ (React)   â”‚    â”‚  åç«¯ (Express)  â”‚    â”‚  å¤–éƒ¨æœåŠ¡é›†æˆ    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ ç”¨æˆ·ç•Œé¢       â”‚â—„â”€â”€â–ºâ”‚ â€¢ APIè·¯ç”±       â”‚â—„â”€â”€â–ºâ”‚ â€¢ OpenAI/Router â”‚
â”‚ â€¢ çŠ¶æ€ç®¡ç†       â”‚    â”‚ â€¢ ä¸šåŠ¡é€»è¾‘       â”‚    â”‚ â€¢ Perplexity AI â”‚
â”‚ â€¢ è·¯ç”±ç®¡ç†       â”‚    â”‚ â€¢ æ•°æ®éªŒè¯       â”‚    â”‚ â€¢ Supabase DB   â”‚
â”‚ â€¢ ç»„ä»¶ç³»ç»Ÿ       â”‚    â”‚ â€¢ æµå¼å“åº”       â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›®å½•ç»“æ„
```
experiment-generator-agent/
â”œâ”€â”€ api/                          # åç«¯APIæœåŠ¡
â”‚   â”œâ”€â”€ app.ts                   # Expressåº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ server.ts                # æœ¬åœ°å¼€å‘æœåŠ¡å™¨
â”‚   â”œâ”€â”€ index.ts                 # Verceléƒ¨ç½²å…¥å£
â”‚   â”œâ”€â”€ lib/                     # æ ¸å¿ƒåº“æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ supabase.ts         # æ•°æ®åº“æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ perplexityMcpClient.ts # Perplexity MCPå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ jsValidator.ts      # JavaScriptä»£ç éªŒè¯
â”‚   â”œâ”€â”€ routes/                  # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ auth.ts             # è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ experiments.ts      # å®éªŒç”Ÿæˆè·¯ç”±
â”‚   â”‚   â””â”€â”€ messages.ts         # æ¶ˆæ¯å’Œå¯¹è¯è·¯ç”±
â”‚   â””â”€â”€ services/               # ä¸šåŠ¡æœåŠ¡å±‚
â”œâ”€â”€ src/                         # å‰ç«¯æºç 
â”‚   â”œâ”€â”€ App.tsx                 # åº”ç”¨æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ main.tsx                # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ pages/                  # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Home.tsx           # ä¸»é¡µé¢(å¯¹è¯ç•Œé¢)
â”‚   â”‚   â””â”€â”€ Demo.tsx           # å®éªŒæ¼”ç¤ºé¡µé¢
â”‚   â”œâ”€â”€ components/             # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ DonationButton.tsx # æèµ æŒ‰é’®
â”‚   â”‚   â”œâ”€â”€ SurveyModal.tsx    # åé¦ˆé—®å·å¼¹çª—
â”‚   â”‚   â”œâ”€â”€ LightRays.tsx      # å…‰çº¿åŠ¨ç”»æ•ˆæœ
â”‚   â”‚   â””â”€â”€ Empty.tsx          # ç©ºçŠ¶æ€ç»„ä»¶
â”‚   â”œâ”€â”€ lib/                    # å·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ api.ts             # APIå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ utils.ts           # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ hooks/                  # è‡ªå®šä¹‰Hook
â”‚       â””â”€â”€ useTheme.ts        # ä¸»é¢˜ç®¡ç†
â”œâ”€â”€ supabase/                   # æ•°æ®åº“é…ç½®
â”‚   â””â”€â”€ migrations/            # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”œâ”€â”€ perplexity-mcp-zerver/     # Perplexity MCPæœåŠ¡å™¨
â””â”€â”€ é…ç½®æ–‡ä»¶
    â”œâ”€â”€ package.json           # é¡¹ç›®ä¾èµ–
    â”œâ”€â”€ vite.config.ts        # Viteé…ç½®
    â”œâ”€â”€ tailwind.config.js    # Tailwindé…ç½®
    â”œâ”€â”€ tsconfig.json         # TypeScripté…ç½®
    â””â”€â”€ vercel.json           # Verceléƒ¨ç½²é…ç½®
```

## æ•°æ®åº“è®¾è®¡

### æ•°æ®è¡¨ç»“æ„

#### messagesè¡¨ (æ ¸å¿ƒè¡¨)
```sql
CREATE TABLE messages (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  conversation_id UUID NOT NULL,
  content TEXT NOT NULL,
  type VARCHAR(20) NOT NULL CHECK (type IN ('user', 'assistant')),
  experiment_id UUID,
  html_content TEXT,
  css_content TEXT,
  js_content TEXT,
  title TEXT,
  is_conversation_root BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

**å­—æ®µè¯´æ˜**:
- `id`: æ¶ˆæ¯å”¯ä¸€æ ‡è¯†
- `conversation_id`: å¯¹è¯IDï¼Œç”¨äºå…³è”åŒä¸€å¯¹è¯çš„æ¶ˆæ¯
- `content`: æ¶ˆæ¯å†…å®¹
- `type`: æ¶ˆæ¯ç±»å‹ ('user' | 'assistant')
- `experiment_id`: å®éªŒIDï¼Œå…³è”ç”Ÿæˆçš„å®éªŒ
- `html_content/css_content/js_content`: ç”Ÿæˆçš„å®éªŒä»£ç 
- `title`: å¯¹è¯æ ‡é¢˜
- `is_conversation_root`: æ˜¯å¦ä¸ºå¯¹è¯æ ¹æ¶ˆæ¯
- `created_at/updated_at`: åˆ›å»ºå’Œæ›´æ–°æ—¶é—´

#### surveysè¡¨ (åé¦ˆè¡¨)
```sql
CREATE TABLE surveys (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  experiment_id UUID NOT NULL,
  reflects_real_world BOOLEAN NOT NULL,
  visualization_rating INTEGER NOT NULL CHECK (visualization_rating >= 1 AND visualization_rating <= 10),
  concept_understanding INTEGER NOT NULL CHECK (concept_understanding >= 1 AND concept_understanding <= 10),
  suggestions TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

**å­—æ®µè¯´æ˜**:
- `experiment_id`: å…³è”çš„å®éªŒID
- `reflects_real_world`: æ˜¯å¦åæ˜ çœŸå®ä¸–ç•ŒåŸç†
- `visualization_rating`: å¯è§†åŒ–æ•ˆæœè¯„åˆ† (1-10)
- `concept_understanding`: æ¦‚å¿µç†è§£åº¦è¯„åˆ† (1-10)
- `suggestions`: æ”¹è¿›å»ºè®®

### æ•°æ®å…³ç³»
- ä¸€ä¸ªå¯¹è¯åŒ…å«å¤šæ¡æ¶ˆæ¯
- ä¸€æ¡åŠ©æ‰‹æ¶ˆæ¯å¯èƒ½åŒ…å«ä¸€ä¸ªå®éªŒ
- ä¸€ä¸ªå®éªŒå¯ä»¥æœ‰å¤šä¸ªç”¨æˆ·åé¦ˆ

## APIæ¥å£è®¾è®¡

### åŸºç¡€è·¯ç”±ç»“æ„
```
/api
â”œâ”€â”€ /auth                    # è®¤è¯ç›¸å…³ (é¢„ç•™)
â”‚   â”œâ”€â”€ GET  /health        # å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ POST /login         # ç™»å½•
â”‚   â”œâ”€â”€ POST /register      # æ³¨å†Œ
â”‚   â””â”€â”€ POST /logout        # ç™»å‡º
â”œâ”€â”€ /experiments            # å®éªŒç”Ÿæˆ
â”‚   â”œâ”€â”€ POST /generate-stream # æµå¼ç”Ÿæˆå®éªŒ
â”‚   â”œâ”€â”€ GET  /:id           # è·å–å®éªŒè¯¦æƒ…
â”‚   â””â”€â”€ POST /survey        # æäº¤åé¦ˆé—®å·
â””â”€â”€ /messages               # æ¶ˆæ¯å’Œå¯¹è¯ç®¡ç†
    â”œâ”€â”€ GET    /conversations                    # è·å–å¯¹è¯åˆ—è¡¨
    â”œâ”€â”€ POST   /conversations                    # åˆ›å»ºæ–°å¯¹è¯
    â”œâ”€â”€ PUT    /conversations/:id/title          # æ›´æ–°å¯¹è¯æ ‡é¢˜
    â”œâ”€â”€ DELETE /conversations/:id                # åˆ é™¤å¯¹è¯
    â”œâ”€â”€ GET    /conversations/:id/messages       # è·å–å¯¹è¯æ¶ˆæ¯
    â”œâ”€â”€ POST   /conversations/:id/messages       # åˆ›å»ºæ¶ˆæ¯
    â””â”€â”€ POST   /generate-stream                  # æµå¼ç”Ÿæˆ (ä¸»è¦æ¥å£)
```

### æ ¸å¿ƒæ¥å£è¯¦æƒ…

#### 1. æµå¼å®éªŒç”Ÿæˆ
```typescript
POST /api/messages/generate-stream
Content-Type: application/json

Request:
{
  "prompt": "åˆ›å»ºä¸€ä¸ªå±•ç¤ºä¼¯åŠªåˆ©åŸç†çš„å®éªŒ",
  "conversation_id": "uuid",
  "message_id": "uuid",
  "model": "openai/gpt-5-mini"
}

Response: (Server-Sent Events)
data: {"type": "search_start", "message": "å¼€å§‹æœç´¢ç›¸å…³çŸ¥è¯†..."}
data: {"type": "search_complete", "knowledge": "ä¼¯åŠªåˆ©åŸç†ç›¸å…³çŸ¥è¯†..."}
data: {"type": "generation_start", "message": "å¼€å§‹ç”Ÿæˆå®éªŒ..."}
data: {"type": "content", "content": "ç”Ÿæˆçš„HTML/CSS/JSä»£ç ç‰‡æ®µ"}
data: {"type": "complete", "experiment_id": "uuid", "title": "å®éªŒæ ‡é¢˜"}
```

#### 2. å¯¹è¯ç®¡ç†
```typescript
// è·å–å¯¹è¯åˆ—è¡¨
GET /api/messages/conversations
Response: Conversation[]

// åˆ›å»ºå¯¹è¯
POST /api/messages/conversations
Request: { "title": "æ–°å¯¹è¯" }
Response: Conversation

// è·å–å¯¹è¯æ¶ˆæ¯
GET /api/messages/conversations/:id/messages
Response: Message[]
```

#### 3. åé¦ˆæäº¤
```typescript
POST /api/experiments/survey
Request: {
  "experiment_id": "uuid",
  "reflects_real_world": true,
  "visualization_rating": 8,
  "concept_understanding": 9,
  "suggestions": "å»ºè®®å¢åŠ æ›´å¤šäº¤äº’å…ƒç´ "
}
Response: { "survey_id": "uuid", "message": "åé¦ˆæäº¤æˆåŠŸ" }
```

## å‰ç«¯è®¾è®¡

### ç»„ä»¶æ¶æ„
```
App
â”œâ”€â”€ Router
    â”œâ”€â”€ Home (ä¸»é¡µé¢)
    â”‚   â”œâ”€â”€ ä¾§è¾¹æ  (å¯¹è¯åˆ—è¡¨)
    â”‚   â”œâ”€â”€ ä¸»èŠå¤©åŒºåŸŸ
    â”‚   â”‚   â”œâ”€â”€ æ¶ˆæ¯åˆ—è¡¨
    â”‚   â”‚   â”œâ”€â”€ è¾“å…¥æ¡†
    â”‚   â”‚   â””â”€â”€ æ¨¡å‹é€‰æ‹©å™¨
    â”‚   â””â”€â”€ SurveyModal (åé¦ˆå¼¹çª—)
    â””â”€â”€ Demo (å®éªŒæ¼”ç¤ºé¡µé¢)
        â”œâ”€â”€ è¿”å›æŒ‰é’®
        â””â”€â”€ å®éªŒiframe
```

### çŠ¶æ€ç®¡ç†
ä½¿ç”¨Zustandè¿›è¡Œè½»é‡çº§çŠ¶æ€ç®¡ç†ï¼š
- å¯¹è¯åˆ—è¡¨çŠ¶æ€
- å½“å‰å¯¹è¯çŠ¶æ€
- æ¶ˆæ¯æµçŠ¶æ€
- UIçŠ¶æ€ (ä¾§è¾¹æ å¼€å…³ã€åŠ è½½çŠ¶æ€ç­‰)

### å…³é”®ç‰¹æ€§

#### 1. æµå¼å“åº”å¤„ç†
```typescript
// å¤„ç†SSEæµå¼å“åº”
const handleStreamResponse = async (response: Response) => {
  const reader = response.body?.getReader();
  const decoder = new TextDecoder();
  
  while (true) {
    const { done, value } = await reader.read();
    if (done) break;
    
    const chunk = decoder.decode(value);
    const lines = chunk.split('\n');
    
    for (const line of lines) {
      if (line.startsWith('data: ')) {
        const data = JSON.parse(line.slice(6));
        handleStreamData(data);
      }
    }
  }
};
```

#### 2. å®éªŒæ¸²æŸ“
```typescript
// åœ¨iframeä¸­å®‰å…¨æ¸²æŸ“å®éªŒä»£ç 
const renderExperiment = (experiment: ExperimentData) => {
  const iframe = document.getElementById('experiment-iframe') as HTMLIFrameElement;
  const fullHtml = `
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="UTF-8">
      <style>${experiment.css_content}</style>
    </head>
    <body>
      ${experiment.html_content}
      <script>${experiment.js_content}</script>
    </body>
    </html>
  `;
  iframe.srcdoc = fullHtml;
};
```

#### 3. å“åº”å¼è®¾è®¡
- ç§»åŠ¨ç«¯é€‚é…çš„ä¾§è¾¹æ 
- çµæ´»çš„å¸ƒå±€ç³»ç»Ÿ
- è§¦æ‘¸å‹å¥½çš„äº¤äº’å…ƒç´ 

## æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### 1. å®éªŒç”Ÿæˆæµç¨‹
```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Frontend as å‰ç«¯
    participant Backend as åç«¯
    participant Perplexity as Perplexity AI
    participant OpenAI as OpenAI/Router
    participant DB as æ•°æ®åº“

    User->>Frontend: è¾“å…¥å®éªŒéœ€æ±‚
    Frontend->>Backend: POST /generate-stream
    Backend->>Perplexity: æœç´¢ç›¸å…³çŸ¥è¯†
    Perplexity-->>Backend: è¿”å›ç§‘å­¦çŸ¥è¯†
    Backend->>OpenAI: ç”Ÿæˆå®éªŒä»£ç 
    OpenAI-->>Backend: æµå¼è¿”å›ä»£ç 
    Backend-->>Frontend: SSEæµå¼å“åº”
    Frontend-->>User: å®æ—¶æ˜¾ç¤ºç”Ÿæˆè¿‡ç¨‹
    Backend->>DB: ä¿å­˜æ¶ˆæ¯å’Œå®éªŒ
    Frontend->>User: æ˜¾ç¤ºå®Œæˆçš„å®éªŒ
```

### 2. å¯¹è¯ç®¡ç†æµç¨‹
```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Frontend as å‰ç«¯
    participant Backend as åç«¯
    participant DB as æ•°æ®åº“

    User->>Frontend: è®¿é—®åº”ç”¨
    Frontend->>Backend: è·å–å¯¹è¯åˆ—è¡¨
    Backend->>DB: æŸ¥è¯¢conversations
    DB-->>Backend: è¿”å›å¯¹è¯æ•°æ®
    Backend-->>Frontend: å¯¹è¯åˆ—è¡¨
    Frontend-->>User: æ˜¾ç¤ºå†å²å¯¹è¯

    User->>Frontend: é€‰æ‹©/åˆ›å»ºå¯¹è¯
    Frontend->>Backend: è·å–æ¶ˆæ¯å†å²
    Backend->>DB: æŸ¥è¯¢messages
    DB-->>Backend: è¿”å›æ¶ˆæ¯åˆ—è¡¨
    Backend-->>Frontend: æ¶ˆæ¯å†å²
    Frontend-->>User: æ˜¾ç¤ºå¯¹è¯å†…å®¹
```

## å¤–éƒ¨æœåŠ¡é›†æˆ

### 1. Perplexity AIé›†æˆ (MCPåè®®)
```typescript
// MCPå®¢æˆ·ç«¯é…ç½®
class PerplexityMCPClient {
  private client: Client;
  private transport: StdioClientTransport;

  async search(query: string, responseType: 'brief' | 'normal' | 'detailed') {
    return await this.client.request({
      method: 'tools/call',
      params: {
        name: 'search',
        arguments: { query, response_type: responseType }
      }
    });
  }

  async getExperimentKnowledge(topic: string) {
    const searchResult = await this.search(
      `${topic} ç‰©ç†åŸç† ç§‘å­¦å®éªŒ å¯è§†åŒ–æ¼”ç¤º`,
      'detailed'
    );
    return searchResult.content;
  }
}
```

### 2. OpenAI/OpenRouteré›†æˆ
```typescript
// OpenAIå®¢æˆ·ç«¯é…ç½®
const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
  baseURL: process.env.OPENAI_BASE_URL || 'https://openrouter.ai/api/v1'
});

// æµå¼ç”Ÿæˆå®éªŒ
const stream = await openai.chat.completions.create({
  model: selectedModel,
  messages: [
    { role: 'system', content: systemPrompt },
    { role: 'user', content: userPrompt }
  ],
  stream: true,
  temperature: 0.7,
  max_tokens: 4000
});
```

### 3. Supabaseæ•°æ®åº“é›†æˆ
```typescript
// Supabaseå®¢æˆ·ç«¯é…ç½®
const supabase = createClient(
  process.env.SUPABASE_URL,
  process.env.SUPABASE_ANON_KEY,
  {
    auth: { persistSession: false }
  }
);

// æ•°æ®åº“æ“ä½œç¤ºä¾‹
class DatabaseService {
  static async createMessage(message: MessageData) {
    const { data, error } = await supabase
      .from('messages')
      .insert(message)
      .select()
      .single();
    
    return error ? null : data;
  }
}
```

## éƒ¨ç½²é…ç½®

### Verceléƒ¨ç½²é…ç½®
```json
// vercel.json
{
  "functions": {
    "api/index.ts": {
      "runtime": "@vercel/node"
    }
  },
  "rewrites": [
    {
      "source": "/api/(.*)",
      "destination": "/api/index.ts"
    }
  ],
  "headers": [
    {
      "source": "/api/(.*)",
      "headers": [
        { "key": "Access-Control-Allow-Origin", "value": "*" },
        { "key": "Access-Control-Allow-Methods", "value": "GET, POST, PUT, DELETE, OPTIONS" },
        { "key": "Access-Control-Allow-Headers", "value": "Content-Type, Authorization" }
      ]
    }
  ]
}
```

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# .env
# OpenAI/OpenRouteré…ç½®
OPENAI_API_KEY=your_openai_api_key
OPENAI_BASE_URL=https://openrouter.ai/api/v1

# Supabaseé…ç½®
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_supabase_anon_key

# æœåŠ¡å™¨é…ç½®
PORT=3001
NODE_ENV=development
```

## å¼€å‘å’Œæ„å»º

### å¼€å‘ç¯å¢ƒå¯åŠ¨
```bash
# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (å‰ç«¯+åç«¯)
npm run dev

# å•ç‹¬å¯åŠ¨å‰ç«¯
npm run client:dev

# å•ç‹¬å¯åŠ¨åç«¯
npm run server:dev
```

### æ„å»ºå’Œéƒ¨ç½²
```bash
# æ„å»ºå‰ç«¯
npm run build

# ç±»å‹æ£€æŸ¥
npm run check

# ä»£ç æ£€æŸ¥
npm run lint

# é¢„è§ˆæ„å»ºç»“æœ
npm run preview
```

## å®‰å…¨è€ƒè™‘

### 1. ä»£ç å®‰å…¨
- JavaScriptä»£ç éªŒè¯å’Œæ¸…ç†
- HTMLæ ‡ç­¾è¿‡æ»¤
- XSSé˜²æŠ¤

### 2. APIå®‰å…¨
- CORSé…ç½®
- è¯·æ±‚å¤§å°é™åˆ¶
- é”™è¯¯ä¿¡æ¯è„±æ•

### 3. æ•°æ®å®‰å…¨
- æ•°æ®åº“RLSç­–ç•¥
- æ•æ„Ÿä¿¡æ¯ç¯å¢ƒå˜é‡ç®¡ç†
- ç”¨æˆ·è¾“å…¥éªŒè¯

## æ€§èƒ½ä¼˜åŒ–

### 1. å‰ç«¯ä¼˜åŒ–
- ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
- å›¾ç‰‡å’Œèµ„æºä¼˜åŒ–
- ç¼“å­˜ç­–ç•¥

### 2. åç«¯ä¼˜åŒ–
- æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- APIå“åº”ç¼“å­˜
- æµå¼å“åº”å‡å°‘å»¶è¿Ÿ

### 3. éƒ¨ç½²ä¼˜åŒ–
- CDNåŠ é€Ÿ
- æœåŠ¡å™¨ç«¯æ¸²æŸ“
- èµ„æºå‹ç¼©

## æ‰©å±•æ€§è®¾è®¡

### 1. æ¨¡å—åŒ–æ¶æ„
- æ’ä»¶åŒ–çš„AIæ¨¡å‹æ”¯æŒ
- å¯æ‰©å±•çš„å®éªŒç±»å‹
- çµæ´»çš„çŸ¥è¯†æºé›†æˆ

### 2. å¾®æœåŠ¡æ¶æ„å‡†å¤‡
- ç‹¬ç«‹çš„æœåŠ¡æ¨¡å—
- APIç½‘å…³è®¾è®¡
- æœåŠ¡é—´é€šä¿¡åè®®

### 3. å¤šç§Ÿæˆ·æ”¯æŒ
- ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- æ•°æ®éš”ç¦»
- æƒé™ç®¡ç†

## ç›‘æ§å’Œæ—¥å¿—

### 1. åº”ç”¨ç›‘æ§
- æ€§èƒ½æŒ‡æ ‡æ”¶é›†
- é”™è¯¯è¿½è¸ª
- ç”¨æˆ·è¡Œä¸ºåˆ†æ

### 2. æ—¥å¿—ç®¡ç†
- ç»“æ„åŒ–æ—¥å¿—
- æ—¥å¿—èšåˆ
- å‘Šè­¦æœºåˆ¶

## æ€»ç»“

è¿™ä¸ªAIå®éªŒå¯è§†åŒ–å¹³å°é‡‡ç”¨äº†ç°ä»£åŒ–çš„å…¨æ ˆæ¶æ„ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **æŠ€æœ¯å…ˆè¿›æ€§**: ä½¿ç”¨æœ€æ–°çš„Reactã€TypeScriptã€Expressç­‰æŠ€æœ¯æ ˆ
2. **AIé›†æˆæ·±åº¦**: æ·±åº¦é›†æˆå¤šä¸ªAIæœåŠ¡ï¼Œæä¾›æ™ºèƒ½åŒ–çš„å®éªŒç”Ÿæˆ
3. **ç”¨æˆ·ä½“éªŒä¼˜ç§€**: æµå¼å“åº”ã€å®æ—¶åé¦ˆã€å“åº”å¼è®¾è®¡
4. **æ¶æ„å¯æ‰©å±•**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤
5. **éƒ¨ç½²ç®€å•**: åŸºäºVercelçš„æ— æœåŠ¡å™¨éƒ¨ç½²ï¼Œè¿ç»´æˆæœ¬ä½

è¯¥æ¶æ„æ–‡æ¡£ä¸ºé‡æ–°å®ç°è¿™ä¸ªé¡¹ç›®æä¾›äº†å®Œæ•´çš„æŠ€æœ¯æŒ‡å¯¼ï¼ŒåŒ…å«äº†æ‰€æœ‰å¿…è¦çš„æŠ€æœ¯ç»†èŠ‚å’Œå®ç°è¦ç‚¹ã€‚
